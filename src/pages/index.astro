---
import BaseLayout from "../layouts/BaseLayout.astro";
import Hero from "../components/Hero.astro";
import ValueProposition from "../components/ValueProposition.astro";
import ReferralProgram from "../components/ReferralProgram.astro";
import Testimonials from "../components/Testimonials.astro";
import ParticipateSection from "../components/ParticipateSection.astro";
import Footer from "../components/Footer.astro";
---

<BaseLayout
  title="Sorteo L'Oreal Paris - Gana un Pack Completo"
  description="Participa en nuestro sorteo exclusivo. Invierte solo $2 y podrías ganar un pack completo de productos L'Oreal Paris valorado en más de $200."
  keywords={["sorteo", "loreal", "paris", "premio", "productos", "cabello"]}
  siteName="Sorteos Md'B"
  author="Sorteos Md'B"
  themeColor="#ff6b9d"
>
  <div class="min-h-screen font-inter">
    <script>
      // Maneja el referral guardándolo en localStorage si viene como query ?r=
      (function () {
        try {
          const params = new URLSearchParams(window.location.search);
          const r = params.get("r");
          const reserved = ["api", "assets", "_astro", "node_modules"];
          let referralStored = false;
          if (
            r &&
            typeof r === "string" &&
            !r.includes(".") &&
            reserved.indexOf(r.toLowerCase()) === -1
          ) {
            localStorage.setItem("referralCode", r);
            referralStored = true;
          }
          // Si ya almacenamos el referral, quitamos el ?r= de la URL para la vista del usuario
          if (referralStored) {
            const url = new URL(window.location.href);
            url.searchParams.delete("r");
            // solo reemplazar si el search cambia realmente
            if (window.location.search !== url.search) {
              window.history.replaceState(
                {},
                document.title,
                url.pathname + url.search + url.hash
              );
            }
          }
        } catch (err) {
          // Silenciar cualquier error de parsing
          console.warn(
            "No se pudo procesar el código de referido del query",
            err
          );
        }
      })();
    </script>
    <Hero />
    <ValueProposition />
    <ReferralProgram />
    <Testimonials />
    <ParticipateSection />
    <Footer />
  </div>
</BaseLayout>
