---
const referralParam = Astro.params.referral ?? [];
const segments = Array.isArray(referralParam) ? referralParam : [referralParam];
const referralCode =
  segments.find((segment) => segment && segment !== "favicon.ico") ?? "";
const referralCodeJSON = JSON.stringify(referralCode);
---

<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <title>Redireccionando...</title>
    <meta name="robots" content="noindex" />
  </head>
  <body>
    <script data-referral={referralCodeJSON}>
      (function () {
        const script = document.currentScript;
        let referralCode = "";
        try {
          const dataValue = script?.dataset?.referral ?? '""';
          referralCode = JSON.parse(dataValue);
        } catch (error) {
          console.warn("No se pudo parsear el referral code", error);
        }

        const reserved = ["api", "assets", "_astro", "node_modules"];
        if (
          referralCode &&
          typeof referralCode === "string" &&
          !referralCode.includes(".") &&
          reserved.indexOf(referralCode.toLowerCase()) === -1
        ) {
          try {
            localStorage.setItem("referralCode", referralCode);
          } catch (error) {
            console.warn("No se pudo guardar el referral code", error);
          }
        }
        window.location.replace("/");
      })();
    </script>
  </body>
</html>
